import{r as ee,c as U,a as O,o as te,i as L,N as ae,F as K,t as B,b as ne,f as V,u as A,s as q,l as N}from"./utils-cxvEfPFo.js";import{g as re,b as j,S as se,a as le,n as ie}from"./index-BxVa1GLd.js";const oe=[{name:"taiwan-z8",description:"Compare the appearance of highways",tags:["highway","cjk","tw"],center:[121.333,24.32],zoom:8},{name:"taiwan-z16-buildings",description:"Compare the appearance of buildings",tags:["building","cjk","tw"],center:[121.4818,25.0271],zoom:16},{name:"world",description:"Country labels",tags:[],center:[121,25],zoom:4},{name:"world2",description:"Country labels",tags:[],center:[0,0],zoom:2},{name:"zurich-bridges",description:"Pedestrian bridge tagged as area",tags:["bridge","ch"],center:[8.54252,47.376925],zoom:17},{name:"brazil-boundaries",description:"admin boundaries other than Brasilia should be visible at zoom 6",tags:["boundaries"],center:[-49.092,-15.092],zoom:6},{name:"kenya-boundaries",description:"admin boundaries level 5 around Nairobi should not appear broken",tags:["boundaries"],center:[37.382,-1.592],zoom:7},{name:"colombia-rivers",description:"water features west of Bogota should not be broken",tags:["water"],center:[-74.422,4.62],zoom:7.8},{name:"river-thames",description:"River Thames should not have pieces missing",tags:["water"],center:[-.3,51.4],zoom:8.9},{name:"landuse-urban-green",description:"show village_green, allotments, playgrounds",tags:[],center:[7.3217,51.50406],zoom:15},{name:"san-francisco-piers",description:"piers in the roads layer are rendered",tags:["roads"],center:[-122.440512,37.807891],zoom:16},{name:"edwards-afb",description:"edwards air force base runways",tags:["landuse"],center:[-118.0726,34.8328],zoom:10},{name:"island-names",description:"label the names of prominent islands at zoom 7",tags:["earth"],center:[-123.22,48.111],zoom:7},{name:"nyc-tunnels",description:"Highway and major road tunnels should have dashed strokes",tags:["roads","tunnels"],center:[-73.9684,40.747621],zoom:17}];var F,Y;function ce(){if(Y)return F;Y=1,F=o;const s={threshold:.1,includeAA:!1,alpha:.1,aaColor:[255,255,0],diffColor:[255,0,0],diffColorAlt:null,diffMask:!1};function o(e,t,a,l,c,n){if(!u(e)||!u(t)||a&&!u(a))throw new Error("Image data: Uint8Array, Uint8ClampedArray or Buffer expected.");if(e.length!==t.length||a&&a.length!==e.length)throw new Error("Image sizes do not match.");if(e.length!==l*c*4)throw new Error("Image data size does not match width/height.");n=Object.assign({},s,n);const i=l*c,m=new Uint32Array(e.buffer,e.byteOffset,i),b=new Uint32Array(t.buffer,t.byteOffset,i);let h=!0;for(let r=0;r<i;r++)if(m[r]!==b[r]){h=!1;break}if(h){if(a&&!n.diffMask)for(let r=0;r<i;r++)T(e,4*r,n.alpha,a);return 0}const x=35215*n.threshold*n.threshold;let f=0;for(let r=0;r<c;r++)for(let p=0;p<l;p++){const v=(r*l+p)*4,y=$(e,t,v,v);Math.abs(y)>x?!n.includeAA&&(g(e,p,r,l,c,t)||g(t,p,r,l,c,e))?a&&!n.diffMask&&k(a,v,...n.aaColor):(a&&k(a,v,...y<0&&n.diffColorAlt||n.diffColor),f++):a&&(n.diffMask||T(e,v,n.alpha,a))}return f}function u(e){return ArrayBuffer.isView(e)&&e.constructor.BYTES_PER_ELEMENT===1}function g(e,t,a,l,c,n){const i=Math.max(t-1,0),m=Math.max(a-1,0),b=Math.min(t+1,l-1),h=Math.min(a+1,c-1),x=(a*l+t)*4;let f=t===i||t===b||a===m||a===h?1:0,r=0,p=0,v,y,S,z;for(let C=i;C<=b;C++)for(let D=m;D<=h;D++){if(C===t&&D===a)continue;const R=$(e,e,x,(D*l+C)*4,!0);if(R===0){if(f++,f>2)return!1}else R<r?(r=R,v=C,y=D):R>p&&(p=R,S=C,z=D)}return r===0||p===0?!1:d(e,v,y,l,c)&&d(n,v,y,l,c)||d(e,S,z,l,c)&&d(n,S,z,l,c)}function d(e,t,a,l,c){const n=Math.max(t-1,0),i=Math.max(a-1,0),m=Math.min(t+1,l-1),b=Math.min(a+1,c-1),h=(a*l+t)*4;let x=t===n||t===m||a===i||a===b?1:0;for(let f=n;f<=m;f++)for(let r=i;r<=b;r++){if(f===t&&r===a)continue;const p=(r*l+f)*4;if(e[h]===e[p]&&e[h+1]===e[p+1]&&e[h+2]===e[p+2]&&e[h+3]===e[p+3]&&x++,x>2)return!0}return!1}function $(e,t,a,l,c){let n=e[a+0],i=e[a+1],m=e[a+2],b=e[a+3],h=t[l+0],x=t[l+1],f=t[l+2],r=t[l+3];if(b===r&&n===h&&i===x&&m===f)return 0;b<255&&(b/=255,n=w(n,b),i=w(i,b),m=w(m,b)),r<255&&(r/=255,h=w(h,r),x=w(x,r),f=w(f,r));const p=M(n,i,m),v=M(h,x,f),y=p-v;if(c)return y;const S=E(n,i,m)-E(h,x,f),z=P(n,i,m)-P(h,x,f),C=.5053*y*y+.299*S*S+.1957*z*z;return p>v?-C:C}function M(e,t,a){return e*.29889531+t*.58662247+a*.11448223}function E(e,t,a){return e*.59597799-t*.2741761-a*.32180189}function P(e,t,a){return e*.21147017-t*.52261711+a*.31114694}function w(e,t){return 255+(e-255)*t}function k(e,t,a,l,c){e[t+0]=a,e[t+1]=l,e[t+2]=c,e[t+3]=255}function T(e,t,a,l){const c=e[t+0],n=e[t+1],i=e[t+2],m=w(M(c,n,i),a*e[t+3]/255);k(l,t,m,m,m)}return F}var fe=ce();const de=re(fe);var me=B('<div class=mt-8><div><img alt=left class="inline-block w-[500px] h-[500px]"><img alt=right class="inline-block w-[500px] h-[500px]"><img alt=diff class="inline-block w-[500px] h-[500px]"></div><div class=space-x-4><a class=underline></a><a class=underline target=_blank rel=noreferrer>(map)</a><span>'),ue=B("<a class=underline>"),he=B('<div class="flex flex-col h-screen w-full"><div class="w-[1500px] mx-auto"><h1 class="my-8 text-4xl">Visual Tests</h1><div class="inline-block w-[500px] font-mono text-xs">leftTiles=<br>leftStyle=</div><div class="inline-block w-[500px] font-mono text-xs">rightTiles=<br>rightStyle=</div><div class="h-0 overflow-hidden"><div class="w-[500px] h-[500px]"></div><div class="w-[500px] h-[500px]"></div><canvas class="w-[500px] h-[500px]"></canvas><canvas class="w-[500px] h-[500px]"></canvas><canvas class="w-[500px] h-[500px]">');const X=(s,o)=>{const u=new Image,g=new Promise(d=>{u.onload=()=>{s.drawImage(u,0,0),d()}});return u.src=o,g},G=(s,o,u)=>new Promise(g=>{s.on("idle",()=>{const d=s.getCanvas();g(d.toDataURL())}),s.jumpTo({center:o,zoom:u})}),H=(s,o,u,g,d)=>new j.Map({container:s,interactive:!1,style:{version:8,center:u,zoom:g,glyphs:"https://protomaps.github.io/basemaps-assets/fonts/{fontstack}/{range}.pbf",sprite:"https://protomaps.github.io/basemaps-assets/sprites/v4/light",sources:{protomaps:{type:"vector",url:`pmtiles://${o}`,attribution:""}},layers:d}}),I=new URLSearchParams(location.search),_=500*window.devicePixelRatio,pe=async(s,o)=>{const[u,g]=await Promise.all([G(s.leftMap,o.center,o.zoom),G(s.rightMap,o.center,o.zoom)]);await X(s.leftCtx,u),await X(s.rightCtx,g);const d=s.diffCtx.createImageData(_,_),$=de(s.leftCtx.getImageData(0,0,_,_).data,s.rightCtx.getImageData(0,0,_,_).data,d.data,_,_,{threshold:.1});return s.diffCtx.putImageData(d,0,0),{pixelsDifferent:$,leftData:u,rightData:g,diffData:s.diffCanvas.toDataURL()}},Q=s=>{const o=new URLSearchParams(I);return o.delete("name"),o.delete("tag"),s.name&&o.set("name",s.name),s.tag&&o.set("tag",s.tag),`/visualtests/?${o.toString()}`},ge=async()=>(await(await fetch("https://registry.npmjs.org/@protomaps/basemaps",{headers:{Accept:"application/vnd.npm.install-v1+json"}})).json())["dist-tags"].latest;function xe(s){let o,u,g;ne(()=>{if(!o||!u||!g){console.error("DOM element not initialized");return}o.src=s.result.rendered.leftData,u.src=s.result.rendered.rightData,g.src=s.result.rendered.diffData});const d=s.result.example;return(()=>{var $=me(),M=$.firstChild,E=M.firstChild,P=E.nextSibling,w=P.nextSibling,k=M.nextSibling,T=k.firstChild,e=T.nextSibling,t=e.nextSibling,a=o;typeof a=="function"?A(a,E):o=E;var l=u;typeof l=="function"?A(l,P):u=P;var c=g;return typeof c=="function"?A(c,w):g=w,L(T,()=>d.name),L(t,()=>d.description),L(k,U(K,{get each(){return d.tags},children:n=>(()=>{var i=ue();return L(i,n),V(()=>q(i,"href",Q({tag:n}))),i})()}),null),V(n=>{var i=Q({name:d.name}),m=`/#map=${d.zoom}/${d.center[1]}/${d.center[0]}`;return i!==n.e&&q(T,"href",n.e=i),m!==n.t&&q(e,"href",n.t=m),n},{e:void 0,t:void 0}),$})()}function be(){let s,o,u,g,d,$,M;const[E,P]=O([]),[w,k]=O({leftTiles:"",rightTiles:"",leftLayersStr:"",rightLayersStr:""});return te(()=>((async()=>{j.getRTLTextPluginStatus()==="unavailable"&&j.setRTLTextPlugin("https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js",!1);const e=new se;j.addProtocol("pmtiles",e.tile);const t=await(await fetch("https://build-metadata.protomaps.dev/builds.json")).json(),a=`https://build.protomaps.com/${t[t.length-1].key}`,l=I.get("leftTiles")||a,c=I.get("rightTiles")||a,n=I.get("leftStyle")||await ge(),i=I.get("rightStyle"),m=await N(n),b=i?await N(i):le("protomaps",ie("light"),{lang:"en"});k({leftTiles:l,rightTiles:c,leftLayersStr:n||"npm@latest",rightLayersStr:i||"local/main"});const h=I.get("name"),x=I.get("tag");let f=oe;h!==null?f=f.filter(R=>R.name===h):x!==null&&(f=f.filter(R=>R.tags.indexOf(x)>=0));const r=f[0];if(!s||!o||!d||!$||!M){console.error("Page failed to initialize");return}u=H(s,l,r.center,r.zoom,m),g=H(o,c,r.center,r.zoom,b);const p=d;p.width=_,p.height=_;const v=$;v.width=_,v.height=_;const y=M;y.width=_,y.height=_;const S=p.getContext("2d",{willReadFrequently:!0}),z=v.getContext("2d",{willReadFrequently:!0}),C=y.getContext("2d",{willReadFrequently:!0});if(!S||!z||!C){console.error("Canvas failed to initialize");return}const D={leftMap:u,rightMap:g,leftCtx:S,rightCtx:z,diffCtx:C,diffCanvas:y};for(const R of f){const W=await pe(D,R);P(Z=>[...Z,{example:R,rendered:W}])}})(),()=>{j.removeProtocol("pmtiles"),u&&u.remove(),g&&g.remove()})),(()=>{var T=he(),e=T.firstChild,t=e.firstChild,a=t.nextSibling,l=a.firstChild,c=l.nextSibling;c.nextSibling;var n=a.nextSibling,i=n.firstChild,m=i.nextSibling;m.nextSibling;var b=n.nextSibling,h=b.firstChild,x=h.nextSibling,f=x.nextSibling,r=f.nextSibling,p=r.nextSibling;L(T,U(ae,{page:2}),e),L(a,()=>w().leftTiles,c),L(a,()=>w().leftLayersStr,null),L(n,()=>w().rightTiles,m),L(n,()=>w().rightLayersStr,null),L(e,U(K,{get each(){return E()},children:D=>U(xe,{result:D})}),b);var v=s;typeof v=="function"?A(v,h):s=h;var y=o;typeof y=="function"?A(y,x):o=x;var S=d;typeof S=="function"?A(S,f):d=f;var z=$;typeof z=="function"?A(z,r):$=r;var C=M;return typeof C=="function"?A(C,p):M=p,T})()}const J=document.getElementById("root");J&&ee(()=>U(be,{}),J);
