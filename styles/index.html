<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset='utf-8'>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@4.5.0/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@4.5.0/dist/maplibre-gl.js'></script>
    <script src="https://unpkg.com/pmtiles@3.0.6/dist/pmtiles.js"></script>

    <style>
        body { margin: 0; padding: 0; }
        html, body, #map { height: 100%; }
        .dropdown-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1; /* Ensure the dropdown is above the map */
            background-color: white;
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
<div class="dropdown-container">
    <select id="map-dropdown">
        <option value="ar">Arabic</option>
        <option value="cs">Czech</option>
        <option value="bg">Bulgarian</option>
        <option value="da">Danish</option>
        <option value="de">German</option>
        <option value="el">Greek</option>
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="et">Estonian</option>
        <option value="fa">Persian</option>
        <option value="fi">Finnish</option>
        <option value="fr">French</option>
        <option value="ga">Irish</option>
        <option value="he">Hebrew</option>
        <option value="hi">Hindi</option>
        <option value="hr">Croatian</option>
        <option value="hu">Hungarian</option>
        <option value="id">Indonesian</option>
        <option value="it">Italian</option>
        <option value="ja">Japanese</option>
        <option value="ko">Korean</option>
        <option value="lt">Lithuanian</option>
        <option value="lv">Latvian</option>
        <option value="ne">Nepali</option>
        <option value="nl">Dutch</option>
        <option value="no">Norwegian</option>
        <option value="mr">Marathi</option>
        <option value="mt">Maltese</option>
        <option value="pl">Polish</option>
        <option value="pt">Portuguese</option>
        <option value="ro">Romanian</option>
        <option value="ru">Russian</option>
        <option value="sk">Slovak</option>
        <option value="sl">Slovenian</option>
        <option value="sv">Swedish</option>
        <option value="tr">Turkish</option>
        <option value="uk">Ukrainian</option>
        <option value="ur">Urdu</option>
        <option value="vi">Vietnamese</option>
        <option value="zh-Hans">Chinese (Simplified)</option>
        <option value="zh-Hant">Chinese (Traditional)</option>

    </select>
</div>
<div id="map"></div>
<script>

    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    function setQueryParam(param, value) {
        const url = new URL(window.location);
        url.searchParams.set(param, value);
        window.history.replaceState(null, '', url.toString());
    }

    var language = getQueryParam('language');
    if (!language) {
        setQueryParam('language', 'en');
        language = 'en';
    }

    async function run() {

        maplibregl.setRTLTextPlugin(
            'https://unpkg.com/@mapbox/mapbox-gl-rtl-text@0.2.3/mapbox-gl-rtl-text.min.js',
            true
        );

        const protocol = new pmtiles.Protocol();
        maplibregl.addProtocol('pmtiles', protocol.tile);


        const map = new maplibregl.Map({
            container: 'map',
            style: `languages/style-${language}.json`,
            center: [24, 38],
            zoom: 8,
            hash: "map"
        });
    }

    run();

    function dropdownChanged() {
        const language = document.getElementById('map-dropdown').value;
        window.location.href = `?language=${language}${window.location.hash}`;
    }

    document.getElementById('map-dropdown').addEventListener('change', dropdownChanged);
    document.getElementById('map-dropdown').value = language;
    
</script>
</body>
</html>