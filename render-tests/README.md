# Render Tests

## Usage

Use the node version in the nvmrc file with `nvm use`.

First build the styles package locally:

```
cd ../styles
npm ci
npm run build
```

Then install the dependencies in the render-test folder with:

```
npm ci
```

Then build the render test runner:

```
npm run build
```

The render test runner is now ready, but we still need to generate some pmtiles with:

```
./generate_pmtiles.sh
```

You should now have a folder `pmtiles`.

Then run the render tests with:

```
npm run test
```

This will create a `results.html` file. Have a look at it with something like

```
npx serve .
```

## Updating Tests

When `expected.png` images should change, you can tell the render test runner to copy the `actual.png` to the `expected.png` images with:

```
UPDATE=true npm run test
```

## Looking at CI `results.html`

The `results.html` generated by GitHub actions runners can be downloaded at the end of the run. The html file will be inside a zip container. This can be convenient to get access to exactly the pixels that are generate in CI.

## License

The code in this folder has been derived from the render tests of MapLibre GL, a fork of Mapbox GL. The license therefore is based on MapLibre's license (BSD), see [LICENSE.md](./LICENSE.md).
